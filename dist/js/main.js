function d(){let n=window.innerWidth,t=document.documentElement.clientWidth,e=n-t,s=n-e;document.documentElement.style.setProperty("--vw",`${s}px`),window.addEventListener("resize",()=>{n=window.innerWidth,t=document.documentElement.clientWidth,e=n-t,s=n-e,document.documentElement.style.setProperty("--vw",`${s}px`)})}class c{constructor(t,e,s,r,i){this.drawerButton=document.querySelector(t),this.nav=document.querySelector(e),this.navButtons=document.querySelectorAll(r),this.closeButton=document.querySelector(i),this.drawerInner=document.querySelector(s),this.drawerButton.setAttribute("aria-expanded","false"),this.nav.setAttribute("aria-hidden","true"),this.closeButton.setAttribute("tabindex","0"),this.init()}init(){this.setupDrawerToggleButton(),this.setupNavButtonActions(),this.setupCloseOutsideClick(),this.preventInnerPropagation(),this.setupCloseButtonClick()}setupDrawerToggleButton(){this.drawerButton.addEventListener("click",()=>{const t=this.drawerButton.getAttribute("aria-expanded")==="true";this.drawerButton.setAttribute("aria-expanded",!t),this.nav.setAttribute("aria-hidden",t),this.drawerButton.classList.toggle("active"),this.nav.classList.toggle("active")})}setupNavButtonActions(){this.navButtons.forEach(t=>{t.addEventListener("click",()=>{(this.drawerButton.classList.contains("active")||this.nav.classList.contains("active"))&&this.closeDrawer()})})}setupCloseOutsideClick(){this.nav.addEventListener("click",t=>{(t.target===this.nav&&this.drawerButton.getAttribute("aria-expanded")==="true"||this.nav.getAttribute("aria-hidden")==="false")&&this.closeDrawer()})}preventInnerPropagation(){this.drawerInner.addEventListener("click",t=>{t.stopPropagation()})}setupCloseButtonClick(){this.closeButton.addEventListener("click",()=>{this.closeDrawer()})}closeDrawer(){this.drawerButton.classList.remove("active"),this.nav.classList.remove("active"),this.drawerButton.setAttribute("aria-expanded","false"),this.nav.setAttribute("aria-hidden","true")}}function u(){console.log("loadedAnimation")}class l{constructor(t,e,s,r,i){this.lengthArray=[],this.loadedArray=[],this.sumLength=0,this.sumLoaded=0,this.log=e,this.progress=s,this.callback=i,this.counter=r,this.init(t)}async init(t){this.lengthArray=await Promise.all([...t].map(async e=>this.getLength(e.dataset.src))),this.loadedArray=[...Array(this.lengthArray.length)].map(()=>0),this.sumLength=this.sum(this.lengthArray),this.sumLoaded=this.sum(this.loadedArray),this.addLog(`合計 ${this.sum(this.lengthArray)} bytes のデータ`);for(let e=0;e<t.length;e++)setTimeout(()=>{this.loadXHR(t[e],e)},`${e*100}`),console.log(`画像読み込み${e+1}枚目完了`)}sum(t){return t.reduce(function(e,s){return e+s},0)}updateProgress(t,e){this.loadedArray[e]=t.loaded,this.sumLoaded=this.sum(this.loadedArray);const s=this.sumLoaded/this.sumLength*100;this.countUp(s),this.addLog(`${t.type}: ${this.sumLoaded} bytes 受信済み`)}countUp(t){let e=this.counter.querySelector(".loading-count__digit--hundred"),s=this.counter.querySelector(".loading-count__digit--ten"),r=this.counter.querySelector(".loading-count__digit--one"),i=Math.floor(t/100%100),o=Math.floor(t/10%10),a=Math.floor(t&10);e.style.setProperty("--progress",i),s.style.setProperty("--progress",o),r.style.setProperty("--progress",a)}updateProgressToFinal(){document.body.classList.add("loaded")}async executeCallback(){console.log("ロード完了→コールバック実行"),await this.callback(),this.updateProgressToFinal()}addLog(t){this.log.textContent=`${this.log.textContent}${t}
`}addListeners(t,e,s){t.addEventListener("loadstart",r=>{this.updateProgress(r,s)}),t.addEventListener("load",r=>{this.updateProgress(r,s)}),t.addEventListener("progress",r=>{this.updateProgress(r,s)}),t.addEventListener("error",r=>{this.updateProgress(r,s)}),t.addEventListener("abort",r=>{this.updateProgress(r,s)}),t.addEventListener("loadend",r=>{this.updateProgress(r,s),t.readyState===t.DONE&&t.status===200&&(e.src=e.dataset.src,this.addLog(`${s+1} 枚目の画像の読み込みが完了`),this.sumLength===this.sumLoaded&&(this.addLog("全ての画像のロード完了（描画が完了したわけではない）"),this.executeCallback()))})}getLength(t){return new Promise((e,s)=>{const r=new XMLHttpRequest;r.addEventListener("readystatechange",()=>{if(r.readyState===r.HEADERS_RECEIVED){const i=parseInt(r.getResponseHeader("Content-Length"));r.abort(),e(i)}}),r.addEventListener("error",()=>{s(0)}),r.open("GET",t),r.send()})}loadXHR(t,e){const s=new XMLHttpRequest;this.addListeners(s,t,e),s.open("GET",t.dataset.src),s.send()}}function h(){d(),new c(".drawer-button",".drawer-nav",".drawer-nav__inner",".drawer-nav a",".drawer-close")}window.addEventListener("load",()=>{let n;try{n=!sessionStorage.getItem("firstAccess"),document.body.classList.add("firstAccess")}catch(t){console.alert("sessionStorage is not accessible: ",t)}if(n)try{sessionStorage.setItem("firstAccess","true")}catch(t){console.alert("sessionStorage is not accessible: ",t)}else document.body.classList.remove("firstAccess");h(),new l(document.querySelectorAll("#loading"),document.querySelector("#log"),document.querySelector("#progress"),document.querySelector("#counter"),u)});
